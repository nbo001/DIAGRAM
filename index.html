<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planification Projet - Villa R+1</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;600;700&family=Orbitron:wght@700;900&family=Roboto:wght@400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            min-height: 100vh;
            padding: 0;
            overflow-x: auto;
        }
        
        /* Navigation */
        .nav {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .nav-button {
            background: linear-gradient(135deg, #1e3c72 0%, #7e22ce 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(126, 34, 206, 0.3);
        }
        
        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(126, 34, 206, 0.5);
        }
        
        /* Hero Section */
        .hero {
            text-align: center;
            padding: 3rem 2rem;
            background: rgba(255, 255, 255, 0.98);
            margin: 2rem;
            border-radius: 20px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        }
        
        .hero h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 4rem;
            background: linear-gradient(135deg, #1e3c72, #7e22ce);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            letter-spacing: 3px;
        }
        
        .hero .subtitle {
            color: #64748b;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .hero .description {
            color: #475569;
            font-size: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Diagram Section */
        .diagram-section {
            margin: 3rem 2rem;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        }
        
        .section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #1e3c72, #7e22ce);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 1rem;
            letter-spacing: 2px;
        }
        
        .section-subtitle {
            text-align: center;
            color: #64748b;
            margin-bottom: 2rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, #1e3c72 0%, #7e22ce 100%);
            color: white;
            border: none;
            padding: 0.85rem 1.8rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(126, 34, 206, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(126, 34, 206, 0.5);
        }
        
        button.active {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        
        /* Network Diagram Styles */
        #network-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 2rem;
            overflow-x: auto;
            position: relative;
            min-height: 700px;
            border: 3px solid #cbd5e0;
        }
        
        svg {
            display: block;
            margin: 0 auto;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .node:hover {
            transform: scale(1.08);
            filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.2));
        }
        
        .node-rect {
            fill: white;
            stroke: #2563eb;
            stroke-width: 3;
            filter: drop-shadow(0 3px 10px rgba(37, 99, 235, 0.25));
            transition: all 0.3s ease;
        }
        
        .node:hover .node-rect {
            fill: #eff6ff;
            stroke: #1d4ed8;
            stroke-width: 4;
        }
        
        .critical-path .node-rect {
            fill: #fee2e2;
            stroke: #dc2626;
            stroke-width: 4;
            filter: drop-shadow(0 4px 12px rgba(220, 38, 38, 0.4));
        }
        
        .node-id {
            font-size: 16px;
            font-weight: 800;
            fill: #1e3c72;
            font-family: 'Bebas Neue', sans-serif;
        }
        
        .node-name {
            font-size: 10px;
            font-weight: 600;
            fill: #334155;
        }
        
        .node-info {
            font-size: 9px;
            font-weight: 600;
            fill: #64748b;
        }
        
        .node-dates {
            font-size: 11px;
            font-weight: 700;
            fill: #7e22ce;
        }
        
        .arrow {
            fill: none;
            stroke: #94a3b8;
            stroke-width: 2.5;
            marker-end: url(#arrowhead);
            transition: all 0.3s ease;
        }
        
        .arrow:hover {
            stroke: #2563eb;
            stroke-width: 4;
        }
        
        .critical-path .arrow {
            stroke: #dc2626;
            stroke-width: 4;
            marker-end: url(#arrowhead-critical);
        }
        
        .arrow-label {
            font-size: 10px;
            font-weight: 700;
            fill: #059669;
            background: white;
            padding: 2px 4px;
        }
        
        .legend {
            display: flex;
            gap: 2.5rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            font-size: 0.95rem;
            font-weight: 600;
            color: #334155;
        }
        
        .legend-box {
            width: 35px;
            height: 25px;
            border-radius: 6px;
            border: 3px solid;
        }
        
        .info-panel {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
            border-left: 6px solid #2563eb;
        }
        
        .info-panel h3 {
            color: #1e293b;
            margin-bottom: 1.5rem;
            font-size: 1.4rem;
            font-weight: 700;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;
        }
        
        .stat-item {
            background: white;
            padding: 1.3rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #7e22ce;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.4rem;
            font-weight: 600;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #1e3c72, #7e22ce);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            color: white;
            padding: 1rem;
            border-radius: 12px;
            font-size: 0.85rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            max-width: 320px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid #7e22ce;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip strong {
            color: #fbbf24;
        }
        
        /* Gantt Chart Styles */
        #gantt-container {
            background: #0f172a;
            border-radius: 16px;
            padding: 1.5rem;
            overflow-x: auto;
            border: 2px solid #334155;
        }
        
        #gantt-chart {
            min-width: 100%;
        }
        
        .gantt-header {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 3px solid #f59e0b;
            padding-bottom: 0.5rem;
        }
        
        .task-column {
            width: 350px;
            font-weight: 700;
            color: #fbbf24;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .timeline-column {
            flex: 1;
            display: flex;
            position: relative;
        }
        
        .day-label {
            font-size: 0.75rem;
            color: #94a3b8;
            text-align: center;
            font-weight: 600;
        }
        
        .gantt-row {
            display: flex;
            margin-bottom: 0.5rem;
            align-items: center;
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-radius: 8px;
        }
        
        .gantt-row:hover {
            background: rgba(245, 158, 11, 0.1);
            transform: translateX(5px);
        }
        
        .task-info {
            width: 350px;
            padding-right: 1rem;
        }
        
        .task-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: #e2e8f0;
            margin-bottom: 0.2rem;
        }
        
        .task-id {
            font-weight: 800;
            color: #fbbf24;
            margin-right: 0.5rem;
        }
        
        .task-details {
            font-size: 0.75rem;
            color: #94a3b8;
        }
        
        .timeline {
            flex: 1;
            position: relative;
            height: 40px;
        }
        
        .task-bar {
            position: absolute;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        
        .task-bar:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
        }
        
        .task-bar.normal {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        .task-bar.critical {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: 2px solid #fbbf24;
        }
        
        .week-separator {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background: rgba(148, 163, 184, 0.3);
            pointer-events: none;
        }
        
        /* Effectif Chart Styles */
        .chart-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 3px solid #cbd5e0;
        }
        
        #effectifChart {
            width: 100%;
            height: 500px;
            overflow-x: auto;
            overflow-y: hidden;
        }
        
        .task-legend {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 0.8rem;
            margin-top: 2rem;
        }
        
        .legend-color {
            width: 25px;
            height: 25px;
            border-radius: 5px;
            flex-shrink: 0;
        }
        
        .legend-text {
            font-weight: 600;
            color: #334155;
        }
        
        .critical-badge {
            background: #dc2626;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 700;
            display: inline-block;
            margin-left: 0.3rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 6px solid #2563eb;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <button class="nav-button" onclick="scrollToSection('reseau')">üìä R√©seau Potentiel</button>
        <button class="nav-button" onclick="scrollToSection('gantt')">üìÖ Diagramme de Gantt</button>
        <button class="nav-button" onclick="scrollToSection('effectif')">üë• Diagramme d'Effectif</button>
    </nav>

    <!-- Hero Section -->
    <div class="hero">
        <h1>PLANIFICATION DE PROJET</h1>
        <p class="subtitle">√âtude et Conception d'une Villa R+1</p>
        <p class="description">Badie AYEB - PFF 2025-2026</p>
    </div>

    <!-- R√©seau Potentiel-T√¢ches Section -->
    <section id="reseau" class="diagram-section">
        <h2 class="section-title">R√©seau Potentiel-T√¢ches</h2>
        <p class="section-subtitle">Visualisation des d√©pendances et du chemin critique</p>
        
        <div class="controls">
            <button onclick="toggleCriticalPath('network')">üéØ Chemin Critique</button>
            <button onclick="zoomIn('network')">üîç Zoom +</button>
            <button onclick="zoomOut('network')">üîç Zoom -</button>
            <button onclick="resetView('network')">‚Üª R√©initialiser</button>
        </div>
        
        <div id="network-container">
            <svg id="network" width="3200" height="1800"></svg>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box" style="background: white; border-color: #2563eb;"></div>
                <span>T√¢che normale</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #fee2e2; border-color: #dc2626;"></div>
                <span>Chemin critique (MT = 0)</span>
            </div>
            <div class="legend-item">
                <div style="background: #1e3c72; color: white; padding: 4px 10px; border-radius: 5px; font-weight: 800; font-size: 0.8rem; border: 2.5px solid #7e22ce;">T08 FD T09</div>
                <span>Lien Fin-D√©but entre t√¢ches</span>
            </div>
            <div class="legend-item">
                <div style="background: white; color: #059669; padding: 4px 8px; border-radius: 5px; font-weight: 800; font-size: 0.85rem; border: 2.5px solid #059669;">+3j</div>
                <span>D√©calage (jours)</span>
            </div>
            <div class="legend-item">
                <div style="font-weight: 800; color: #7e22ce; font-size: 1.1rem;">MT</div>
                <span>Marge Totale</span>
            </div>
            <div class="legend-item">
                <div style="font-weight: 800; color: #7e22ce; font-size: 1.1rem;">ML</div>
                <span>Marge Libre</span>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>üìä Statistiques du Projet</h3>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">Dur√©e totale du projet</div>
                    <div class="stat-value" id="total-duration-network">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Nombre de t√¢ches</div>
                    <div class="stat-value">26</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">T√¢ches critiques</div>
                    <div class="stat-value" id="critical-tasks-network">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Effectif maximal</div>
                    <div class="stat-value">5 personnes</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Gantt Chart Section -->
    <section id="gantt" class="diagram-section">
        <h2 class="section-title">Diagramme de Gantt</h2>
        <p class="section-subtitle">Planning temporel des t√¢ches du projet</p>
        
        <div class="controls">
            <button onclick="toggleCriticalPath('gantt')">üéØ Afficher Chemin Critique</button>
            <button onclick="zoomIn('gantt')">üîç Zoom +</button>
            <button onclick="zoomOut('gantt')">üîç Zoom -</button>
            <button onclick="resetView('gantt')">‚Üª R√©initialiser</button>
        </div>
        
        <div id="gantt-container">
            <div id="gantt-chart"></div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div>
                <span>T√¢che normale</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: linear-gradient(135deg, #ef4444, #dc2626); border: 2px solid #fbbf24;"></div>
                <span>Chemin critique</span>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>üìä Statistiques du Projet</h3>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">Dur√©e totale du projet</div>
                    <div class="stat-value" id="total-duration-gantt">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Nombre de t√¢ches</div>
                    <div class="stat-value">26</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">T√¢ches critiques</div>
                    <div class="stat-value" id="critical-tasks-gantt">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Effectif maximal</div>
                    <div class="stat-value">5</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Effectif Chart Section -->
    <section id="effectif" class="diagram-section">
        <h2 class="section-title">Diagramme d'Effectif</h2>
        <p class="section-subtitle">Planification des ressources humaines</p>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Effectif Maximum</div>
                <div class="stat-value" id="maxEffectif">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Dur√©e Totale</div>
                <div class="stat-value" id="totalDuration-effectif">0 jours</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Nombre de T√¢ches</div>
                <div class="stat-value" id="taskCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">T√¢ches Critiques</div>
                <div class="stat-value" id="criticalCount">0</div>
            </div>
        </div>
        
        <div class="controls">
            <button onclick="toggleView('stacked')" class="active" id="btnStacked">Vue Empil√©e</button>
            <button onclick="toggleView('cumulative')" id="btnCumulative">Vue Cumulative</button>
            <button onclick="toggleCriticalPath('effectif')">Afficher Chemin Critique</button>
        </div>
        
        <div class="chart-container">
            <div id="effectifChart"></div>
        </div>
        
        <div class="task-legend" id="taskLegend"></div>
    </section>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Shared tasks data
        const tasks = [
            {id: 1, name: "D√©capage terrain", duration: 1, effectif: 1, next: [2], delay: 0},
            {id: 2, name: "Fouilles puits/rigoles", duration: 1, effectif: 2, next: [3], delay: 0},
            {id: 3, name: "Gros b√©ton", duration: 1, effectif: 3, next: [4], delay: 0},
            {id: 4, name: "B√©ton propret√©", duration: 1, effectif: 3, next: [5], delay: 0},
            {id: 5, name: "B.A fondation", duration: 3, effectif: 3, next: [6], delay: 0},
            {id: 6, name: "Chape arm√©e", duration: 6, effectif: 5, next: [7], delay: 0},
            {id: 7, name: "B.A √©l√©v. RDC", duration: 6, effectif: 5, next: [8], delay: 0},
            {id: 8, name: "Plancher RDC", duration: 15, effectif: 5, next: [9], delay: 3},
            {id: 9, name: "Escalier RDC", duration: 2, effectif: 5, next: [10], delay: 0},
            {id: 10, name: "B.A √©l√©v. √©tage", duration: 6, effectif: 5, next: [11], delay: 0},
            {id: 11, name: "Plancher √©tage", duration: 12, effectif: 5, next: [12], delay: 3},
            {id: 12, name: "Escalier √©tage", duration: 2, effectif: 5, next: [13], delay: 0},
            {id: 13, name: "Ma√ßonnerie", duration: 30, effectif: 5, next: [14], delay: -15},
            {id: 14, name: "Enduit int√©rieur", duration: 30, effectif: 5, next: [15], delay: -5},
            {id: 15, name: "Enduit ext√©rieur", duration: 15, effectif: 5, next: [16], delay: 7},
            {id: 16, name: "Pose Staff", duration: 30, effectif: 2, next: [17], delay: 3},
            {id: 17, name: "Acrot√®re", duration: 2, effectif: 2, next: [18], delay: 0},
            {id: 18, name: "√âtanch√©it√©", duration: 1, effectif: 3, next: [19], delay: 0},
            {id: 19, name: "Forme de pente", duration: 1, effectif: 3, next: [20], delay: 0},
            {id: 20, name: "Rev√™tement", duration: 30, effectif: 5, next: [21], delay: -10},
            {id: 21, name: "Seuils/appuis", duration: 1, effectif: 4, next: [22], delay: 0},
            {id: 22, name: "Menuiserie pose", duration: 3, effectif: 4, next: [23, 24], delay: 0},
            {id: 23, name: "√âlectricit√©", duration: 8, effectif: 4, next: [25], delay: 0},
            {id: 24, name: "Plomberie", duration: 6, effectif: 4, next: [25], delay: 0},
            {id: 25, name: "Peinture", duration: 35, effectif: 4, next: [26], delay: 0},
            {id: 26, name: "Nettoyage", duration: 3, effectif: 2, next: [], delay: 0}
        ];

        // ========== NETWORK DIAGRAM ==========
        let showCriticalNetwork = false;
        let currentScaleNetwork = 1;
        let criticalPathNetwork = [];
        
        function calculateDates() {
            tasks.forEach(task => {
                task.earlyStart = 0;
                task.earlyFinish = 0;
                task.lateStart = 0;
                task.lateFinish = 0;
                task.slack = 0;
                task.freeSlack = 0;
            });

            // Calcul au plus t√¥t (DTO)
            tasks.forEach(task => {
                task.earlyFinish = task.earlyStart + task.duration;
                
                task.next.forEach(nextId => {
                    const nextTask = tasks.find(t => t.id === nextId);
                    const delay = task.delay || 0;
                    const earlyStart = task.earlyFinish + delay;
                    if (earlyStart > nextTask.earlyStart) {
                        nextTask.earlyStart = earlyStart;
                    }
                });
            });

            // Recalcul des fins au plus t√¥t
            tasks.forEach(task => {
                task.earlyFinish = task.earlyStart + task.duration;
            });

            // Calcul au plus tard (DTA)
            const lastTask = tasks[tasks.length - 1];
            lastTask.lateFinish = lastTask.earlyFinish;
            lastTask.lateStart = lastTask.lateFinish - lastTask.duration;

            for (let i = tasks.length - 2; i >= 0; i--) {
                const task = tasks[i];
                if (task.next.length === 0) {
                    task.lateFinish = lastTask.lateFinish;
                } else {
                    task.lateFinish = Math.min(...task.next.map(nextId => {
                        const nextTask = tasks.find(t => t.id === nextId);
                        const delay = task.delay || 0;
                        return nextTask.lateStart - delay;
                    }));
                }
                task.lateStart = task.lateFinish - task.duration;
                task.slack = task.lateStart - task.earlyStart;
            }

            // Calcul de la marge libre
            tasks.forEach(task => {
                if (task.next.length === 0) {
                    task.freeSlack = task.slack;
                } else {
                    const minNextEarlyStart = Math.min(...task.next.map(nextId => {
                        const nextTask = tasks.find(t => t.id === nextId);
                        const delay = task.delay || 0;
                        return nextTask.earlyStart - delay;
                    }));
                    task.freeSlack = minNextEarlyStart - task.earlyFinish;
                }
            });

            // Identifier le chemin critique
            criticalPathNetwork = tasks.filter(t => t.slack === 0).map(t => t.id);
            
            return lastTask.earlyFinish;
        }

        function drawNetwork() {
            const svg = document.getElementById('network');
            const width = 3200;
            const height = 1800;
            
            svg.innerHTML = `
                <defs>
                    <marker id="arrowhead" markerWidth="12" markerHeight="12" refX="10" refY="4" orient="auto">
                        <polygon points="0 0, 12 4, 0 8" fill="#94a3b8" />
                    </marker>
                    <marker id="arrowhead-critical" markerWidth="12" markerHeight="12" refX="10" refY="4" orient="auto">
                        <polygon points="0 0, 12 4, 0 8" fill="#dc2626" />
                    </marker>
                </defs>
            `;

            const positions = {
                1: {x: 80, y: 100}, 2: {x: 280, y: 100}, 3: {x: 480, y: 100}, 
                4: {x: 680, y: 100}, 5: {x: 880, y: 100}, 6: {x: 1080, y: 100},
                7: {x: 1280, y: 100}, 8: {x: 1480, y: 100}, 9: {x: 1730, y: 100},
                10: {x: 1930, y: 100}, 11: {x: 2130, y: 100}, 12: {x: 2380, y: 100},
                13: {x: 2580, y: 250}, 14: {x: 2780, y: 400}, 15: {x: 2580, y: 600},
                16: {x: 2380, y: 800}, 17: {x: 2180, y: 1000}, 18: {x: 1980, y: 1150},
                19: {x: 1780, y: 1300}, 20: {x: 1480, y: 1450}, 21: {x: 1180, y: 1500},
                22: {x: 930, y: 1450}, 23: {x: 680, y: 1350}, 24: {x: 680, y: 1550},
                25: {x: 430, y: 1450}, 26: {x: 180, y: 1450}
            };

            // Dessiner les fl√®ches
            tasks.forEach(task => {
                const pos1 = positions[task.id];
                task.next.forEach(nextId => {
                    const pos2 = positions[nextId];
                    const isCritical = showCriticalNetwork && criticalPathNetwork.includes(task.id) && criticalPathNetwork.includes(nextId);
                    
                    const path = `M ${pos1.x + 80} ${pos1.y + 50} L ${pos2.x} ${pos2.y + 50}`;
                    const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    arrow.setAttribute('d', path);
                    arrow.setAttribute('class', isCritical ? 'arrow critical-path' : 'arrow');
                    svg.appendChild(arrow);
                    
                    const midX = (pos1.x + 80 + pos2.x) / 2;
                    const midY = (pos1.y + 50 + pos2.y + 50) / 2;
                    
                    const linkText = `T${String(task.id).padStart(2, '0')} FD T${String(nextId).padStart(2, '0')}`;
                    
                    const linkBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    const linkTextWidth = linkText.length * 6.5;
                    linkBg.setAttribute('x', midX - linkTextWidth/2 - 4);
                    linkBg.setAttribute('y', midY - 27);
                    linkBg.setAttribute('width', linkTextWidth + 8);
                    linkBg.setAttribute('height', 18);
                    linkBg.setAttribute('rx', 5);
                    linkBg.setAttribute('fill', '#1e3c72');
                    linkBg.setAttribute('stroke', '#7e22ce');
                    linkBg.setAttribute('stroke-width', 2.5);
                    svg.appendChild(linkBg);
                    
                    const linkLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    linkLabel.setAttribute('x', midX);
                    linkLabel.setAttribute('y', midY - 14);
                    linkLabel.setAttribute('text-anchor', 'middle');
                    linkLabel.setAttribute('style', 'font-size: 10px; font-weight: 800; fill: white;');
                    linkLabel.textContent = linkText;
                    svg.appendChild(linkLabel);
                    
                    if (task.delay && task.delay !== 0) {
                        const labelBg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                        labelBg.setAttribute('x', midX - 20);
                        labelBg.setAttribute('y', midY - 5);
                        labelBg.setAttribute('width', 40);
                        labelBg.setAttribute('height', 18);
                        labelBg.setAttribute('rx', 5);
                        labelBg.setAttribute('fill', 'white');
                        labelBg.setAttribute('stroke', '#059669');
                        labelBg.setAttribute('stroke-width', 2.5);
                        svg.appendChild(labelBg);
                        
                        const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        label.setAttribute('x', midX);
                        label.setAttribute('y', midY + 8);
                        label.setAttribute('text-anchor', 'middle');
                        label.setAttribute('class', 'arrow-label');
                        label.textContent = task.delay > 0 ? `+${task.delay}j` : `${task.delay}j`;
                        svg.appendChild(label);
                    }
                });
            });

            // Dessiner les n≈ìuds
            tasks.forEach(task => {
                const pos = positions[task.id];
                const isCritical = showCriticalNetwork && criticalPathNetwork.includes(task.id);
                
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.setAttribute('class', isCritical ? 'node critical-path' : 'node');
                g.setAttribute('data-task-id', task.id);
                
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', pos.x);
                rect.setAttribute('y', pos.y);
                rect.setAttribute('width', 160);
                rect.setAttribute('height', 115);
                rect.setAttribute('rx', 10);
                rect.setAttribute('class', 'node-rect');
                
                const textId = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                textId.setAttribute('x', pos.x + 15);
                textId.setAttribute('y', pos.y + 22);
                textId.setAttribute('class', 'node-id');
                textId.textContent = `T${String(task.id).padStart(2, '0')}`;
                
                const textName = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                textName.setAttribute('x', pos.x + 80);
                textName.setAttribute('y', pos.y + 40);
                textName.setAttribute('text-anchor', 'middle');
                textName.setAttribute('class', 'node-name');
                textName.textContent = task.name.length > 16 ? task.name.substring(0, 14) + '...' : task.name;
                
                const textInfo = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                textInfo.setAttribute('x', pos.x + 80);
                textInfo.setAttribute('y', pos.y + 55);
                textInfo.setAttribute('text-anchor', 'middle');
                textInfo.setAttribute('class', 'node-info');
                textInfo.textContent = `Dur√©e: ${task.duration}j | Eff: ${task.effectif}`;
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', pos.x + 10);
                line.setAttribute('y1', pos.y + 65);
                line.setAttribute('x2', pos.x + 150);
                line.setAttribute('y2', pos.y + 65);
                line.setAttribute('stroke', '#cbd5e0');
                line.setAttribute('stroke-width', 1.5);
                
                const textDTO = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                textDTO.setAttribute('x', pos.x + 15);
                textDTO.setAttribute('y', pos.y + 82);
                textDTO.setAttribute('class', 'node-dates');
                textDTO.textContent = `DTO: ${task.earlyStart}`;
                
                const textDTA = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                textDTA.setAttribute('x', pos.x + 145);
                textDTA.setAttribute('y', pos.y + 82);
                textDTA.setAttribute('text-anchor', 'end');
                textDTA.setAttribute('class', 'node-dates');
                textDTA.textContent = `DTA: ${task.lateStart}`;
                
                const textMT = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                textMT.setAttribute('x', pos.x + 50);
                textMT.setAttribute('y', pos.y + 95);
                textMT.setAttribute('text-anchor', 'middle');
                textMT.setAttribute('class', 'node-dates');
                textMT.setAttribute('style', 'font-size: 11px; font-weight: 800;');
                textMT.textContent = `MT: ${task.slack}j`;
                if (task.slack === 0) {
                    textMT.setAttribute('fill', '#dc2626');
                }
                
                const textML = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                textML.setAttribute('x', pos.x + 110);
                textML.setAttribute('y', pos.y + 95);
                textML.setAttribute('text-anchor', 'middle');
                textML.setAttribute('class', 'node-dates');
                textML.setAttribute('style', 'font-size: 11px; font-weight: 800;');
                textML.textContent = `ML: ${task.freeSlack}j`;
                if (task.freeSlack === 0) {
                    textML.setAttribute('fill', '#dc2626');
                }
                
                g.appendChild(rect);
                g.appendChild(textId);
                g.appendChild(textName);
                g.appendChild(textInfo);
                g.appendChild(line);
                g.appendChild(textDTO);
                g.appendChild(textDTA);
                g.appendChild(textMT);
                g.appendChild(textML);
                
                g.addEventListener('mouseenter', (e) => showTooltip(e, task));
                g.addEventListener('mouseleave', hideTooltip);
                
                svg.appendChild(g);
            });
        }

        function showTooltip(e, task) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `
                <strong>T√¢che ${String(task.id).padStart(2, '0')}: ${task.name}</strong><br><br>
                üìÖ <strong>Dur√©e:</strong> ${task.duration} jour(s)<br>
                üë• <strong>Effectif:</strong> ${task.effectif} personne(s)<br><br>
                üü¢ <strong>DTO (D√©but au + T√¥t):</strong> Jour ${task.earlyStart}<br>
                üî¥ <strong>DTA (D√©but au + Tard):</strong> Jour ${task.lateStart}<br><br>
                üìä <strong>MT (Marge Totale):</strong> ${task.slack} jour(s)<br>
                üìä <strong>ML (Marge Libre):</strong> ${task.freeSlack} jour(s)<br>
                ${task.slack === 0 ? '<br><span style="color: #fbbf24;">‚ö†Ô∏è T√ÇCHE CRITIQUE - AUCUNE MARGE TOTALE !</span>' : ''}
                ${task.freeSlack === 0 && task.slack > 0 ? '<br><span style="color: #fb923c;">‚ö° Aucune marge libre - Impact direct sur t√¢ches suivantes</span>' : ''}
            `;
            tooltip.style.left = e.pageX + 20 + 'px';
            tooltip.style.top = e.pageY + 20 + 'px';
            tooltip.classList.add('show');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('show');
        }

        function toggleCriticalPath(type) {
            if (type === 'network') {
                showCriticalNetwork = !showCriticalNetwork;
                drawNetwork();
            } else if (type === 'gantt') {
                showCriticalGantt = !showCriticalGantt;
                drawGantt();
            } else if (type === 'effectif') {
                showCriticalEffectif = !showCriticalEffectif;
                drawEffectifChart();
            }
        }

        function zoomIn(type) {
            if (type === 'network') {
                currentScaleNetwork *= 1.25;
                const svg = document.getElementById('network');
                svg.style.transform = `scale(${currentScaleNetwork})`;
                svg.style.transformOrigin = 'top left';
            } else if (type === 'gantt') {
                dayWidthGantt *= 1.3;
                drawGantt();
            }
        }

        function zoomOut(type) {
            if (type === 'network') {
                currentScaleNetwork /= 1.25;
                const svg = document.getElementById('network');
                svg.style.transform = `scale(${currentScaleNetwork})`;
                svg.style.transformOrigin = 'top left';
            } else if (type === 'gantt') {
                dayWidthGantt /= 1.3;
                drawGantt();
            }
        }

        function resetView(type) {
            if (type === 'network') {
                currentScaleNetwork = 1;
                const svg = document.getElementById('network');
                svg.style.transform = `scale(${currentScaleNetwork})`;
                svg.style.transformOrigin = 'top left';
            } else if (type === 'gantt') {
                dayWidthGantt = 8;
                drawGantt();
            }
        }

        // ========== GANTT CHART ==========
        let showCriticalGantt = false;
        let dayWidthGantt = 8;
        let criticalPathGantt = [];

        function drawGantt() {
            const totalDuration = calculateDates();
            criticalPathGantt = criticalPathNetwork;
            const chart = document.getElementById('gantt-chart');
            chart.innerHTML = '';
            
            const header = document.createElement('div');
            header.className = 'gantt-header';
            
            const taskCol = document.createElement('div');
            taskCol.className = 'task-column';
            taskCol.textContent = 'T√¢ches';
            
            const timelineCol = document.createElement('div');
            timelineCol.className = 'timeline-column';
            
            for (let i = 0; i <= totalDuration; i += 5) {
                const dayLabel = document.createElement('div');
                dayLabel.className = 'day-label';
                dayLabel.style.position = 'absolute';
                dayLabel.style.left = `${i * dayWidthGantt}px`;
                dayLabel.textContent = `J${i}`;
                timelineCol.appendChild(dayLabel);
            }
            
            for (let i = 7; i <= totalDuration; i += 7) {
                const separator = document.createElement('div');
                separator.className = 'week-separator';
                separator.style.left = `${i * dayWidthGantt}px`;
                timelineCol.appendChild(separator);
            }
            
            header.appendChild(taskCol);
            header.appendChild(timelineCol);
            chart.appendChild(header);
            
            tasks.forEach(task => {
                const row = document.createElement('div');
                row.className = 'gantt-row';
                
                const taskInfo = document.createElement('div');
                taskInfo.className = 'task-info';
                taskInfo.innerHTML = `
                    <div class="task-name">
                        <span class="task-id">T${String(task.id).padStart(2, '0')}</span>
                        ${task.name}
                    </div>
                    <div class="task-details">
                        Dur√©e: ${task.duration}j | Effectif: ${task.effectif} | 
                        Marge: ${task.slack}j
                    </div>
                `;
                
                const timeline = document.createElement('div');
                timeline.className = 'timeline';
                
                const taskBar = document.createElement('div');
                taskBar.className = `task-bar ${showCriticalGantt && criticalPathGantt.includes(task.id) ? 'critical' : 'normal'}`;
                taskBar.style.left = `${task.earlyStart * dayWidthGantt}px`;
                taskBar.style.width = `${task.duration * dayWidthGantt}px`;
                taskBar.textContent = `${task.duration}j`;
                
                taskBar.addEventListener('mouseenter', (e) => showTooltipGantt(e, task));
                taskBar.addEventListener('mouseleave', hideTooltip);
                
                timeline.appendChild(taskBar);
                
                row.appendChild(taskInfo);
                row.appendChild(timeline);
                chart.appendChild(row);
            });
        }

        function showTooltipGantt(e, task) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `
                <strong>T√¢che ${String(task.id).padStart(2, '0')}: ${task.name}</strong><br><br>
                üìÖ <strong>D√©but:</strong> Jour ${task.earlyStart}<br>
                üìÖ <strong>Fin:</strong> Jour ${task.earlyFinish}<br>
                ‚è±Ô∏è <strong>Dur√©e:</strong> ${task.duration} jour(s)<br>
                üë• <strong>Effectif:</strong> ${task.effectif} personne(s)<br>
                üìä <strong>Marge:</strong> ${task.slack} jour(s)<br>
                ${task.slack === 0 ? '<br><span style="color: #fbbf24;">‚ö†Ô∏è T√ÇCHE CRITIQUE</span>' : ''}
            `;
            tooltip.style.left = e.pageX + 20 + 'px';
            tooltip.style.top = e.pageY + 20 + 'px';
            tooltip.classList.add('show');
        }

        // ========== EFFECTIF CHART ==========
        let currentView = 'stacked';
        let showCriticalEffectif = false;
        let criticalPathEffectif = [];
        
        const colors = [
            '#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6',
            '#ec4899', '#14b8a6', '#f97316', '#6366f1', '#84cc16',
            '#06b6d4', '#a855f7', '#eab308', '#22c55e', '#f43f5e',
            '#0ea5e9', '#d946ef', '#64748b', '#fb923c', '#4ade80',
            '#0891b2', '#c026d3', '#facc15', '#38bdf8', '#fb7185', '#94a3b8'
        ];
        
        function drawEffectifChart() {
            const totalDuration = calculateDates();
            criticalPathEffectif = criticalPathNetwork;
            const chartDiv = document.getElementById('effectifChart');
            chartDiv.innerHTML = '';
            
            const width = Math.max(1200, totalDuration * 15);
            const height = 450;
            const margin = {top: 40, right: 40, bottom: 80, left: 60};
            const chartWidth = width - margin.left - margin.right;
            const chartHeight = height - margin.top - margin.bottom;
            
            const dailyEffectif = new Array(totalDuration + 1).fill(0);
            const dailyTasks = {};
            
            for (let day = 0; day <= totalDuration; day++) {
                dailyTasks[day] = [];
            }
            
            tasks.forEach(task => {
                for (let day = task.earlyStart; day < task.earlyStart + task.duration; day++) {
                    dailyEffectif[day] += task.effectif;
                    dailyTasks[day].push(task);
                }
            });
            
            const maxEffectif = Math.max(...dailyEffectif);
            
            document.getElementById('maxEffectif').textContent = maxEffectif + ' pers.';
            document.getElementById('totalDuration-effectif').textContent = totalDuration + ' jours';
            document.getElementById('taskCount').textContent = tasks.length;
            document.getElementById('criticalCount').textContent = criticalPathEffectif.length;
            
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', width);
            svg.setAttribute('height', height);
            svg.style.display = 'block';
            svg.style.margin = '0 auto';
            
            for (let i = 0; i <= maxEffectif; i += 5) {
                const y = margin.top + chartHeight - (i / maxEffectif) * chartHeight;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', margin.left);
                line.setAttribute('y1', y);
                line.setAttribute('x2', margin.left + chartWidth);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', '#e2e8f0');
                line.setAttribute('stroke-width', i === 0 ? 2 : 1);
                svg.appendChild(line);
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', margin.left - 10);
                text.setAttribute('y', y + 5);
                text.setAttribute('text-anchor', 'end');
                text.setAttribute('fill', '#64748b');
                text.setAttribute('font-size', '12px');
                text.setAttribute('font-weight', '600');
                text.textContent = i;
                svg.appendChild(text);
            }
            
            if (currentView === 'stacked') {
                drawStackedView(svg, dailyEffectif, dailyTasks, chartWidth, chartHeight, margin, totalDuration, maxEffectif);
            } else {
                drawCumulativeView(svg, dailyEffectif, chartWidth, chartHeight, margin, totalDuration, maxEffectif);
            }
            
            for (let day = 0; day <= totalDuration; day += 5) {
                const x = margin.left + (day / totalDuration) * chartWidth;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x);
                line.setAttribute('y1', margin.top);
                line.setAttribute('x2', x);
                line.setAttribute('y2', margin.top + chartHeight);
                line.setAttribute('stroke', '#cbd5e0');
                line.setAttribute('stroke-width', 1);
                line.setAttribute('stroke-dasharray', '3,3');
                svg.appendChild(line);
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', x);
                text.setAttribute('y', margin.top + chartHeight + 25);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#64748b');
                text.setAttribute('font-size', '12px');
                text.setAttribute('font-weight', '600');
                text.textContent = `J${day}`;
                svg.appendChild(text);
            }
            
            const xLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            xLabel.setAttribute('x', margin.left + chartWidth / 2);
            xLabel.setAttribute('y', height - 20);
            xLabel.setAttribute('text-anchor', 'middle');
            xLabel.setAttribute('fill', '#1e3c72');
            xLabel.setAttribute('font-size', '14px');
            xLabel.setAttribute('font-weight', '700');
            xLabel.textContent = 'Jours';
            svg.appendChild(xLabel);
            
            const yLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            yLabel.setAttribute('x', -height / 2);
            yLabel.setAttribute('y', 20);
            yLabel.setAttribute('text-anchor', 'middle');
            yLabel.setAttribute('fill', '#1e3c72');
            yLabel.setAttribute('font-size', '14px');
            yLabel.setAttribute('font-weight', '700');
            yLabel.setAttribute('transform', 'rotate(-90)');
            yLabel.textContent = 'Effectif (personnes)';
            svg.appendChild(yLabel);
            
            chartDiv.appendChild(svg);
            
            drawLegend();
        }
        
        function drawStackedView(svg, dailyEffectif, dailyTasks, chartWidth, chartHeight, margin, totalDuration, maxEffectif) {
            const barWidth = chartWidth / totalDuration;
            
            for (let day = 0; day < totalDuration; day++) {
                const tasksOnDay = dailyTasks[day];
                let currentHeight = 0;
                
                tasksOnDay.forEach(task => {
                    const taskHeight = (task.effectif / maxEffectif) * chartHeight;
                    const x = margin.left + (day / totalDuration) * chartWidth;
                    const y = margin.top + chartHeight - currentHeight - taskHeight;
                    
                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    rect.setAttribute('x', x);
                    rect.setAttribute('y', y);
                    rect.setAttribute('width', barWidth * 0.9);
                    rect.setAttribute('height', taskHeight);
                    rect.setAttribute('fill', showCriticalEffectif && criticalPathEffectif.includes(task.id) ? '#dc2626' : colors[(task.id - 1) % colors.length]);
                    rect.setAttribute('stroke', 'white');
                    rect.setAttribute('stroke-width', 1);
                    rect.setAttribute('opacity', '0.85');
                    rect.style.cursor = 'pointer';
                    
                    rect.addEventListener('mouseenter', (e) => showTooltipEffectif(e, task, day));
                    rect.addEventListener('mouseleave', hideTooltip);
                    
                    svg.appendChild(rect);
                    currentHeight += taskHeight;
                });
            }
        }
        
        function drawCumulativeView(svg, dailyEffectif, chartWidth, chartHeight, margin, totalDuration, maxEffectif) {
            const points = dailyEffectif.map((effectif, day) => {
                const x = margin.left + (day / totalDuration) * chartWidth;
                const y = margin.top + chartHeight - (effectif / maxEffectif) * chartHeight;
                return `${x},${y}`;
            }).join(' ');
            
            const area = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            const areaPoints = `${margin.left},${margin.top + chartHeight} ` + points + ` ${margin.left + chartWidth},${margin.top + chartHeight}`;
            area.setAttribute('points', areaPoints);
            area.setAttribute('fill', showCriticalEffectif ? 'rgba(220, 38, 38, 0.2)' : 'rgba(59, 130, 246, 0.2)');
            svg.appendChild(area);
            
            const polyline = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
            polyline.setAttribute('points', points);
            polyline.setAttribute('fill', 'none');
            polyline.setAttribute('stroke', showCriticalEffectif ? '#dc2626' : '#3b82f6');
            polyline.setAttribute('stroke-width', 3);
            svg.appendChild(polyline);
            
            dailyEffectif.forEach((effectif, day) => {
                const x = margin.left + (day / totalDuration) * chartWidth;
                const y = margin.top + chartHeight - (effectif / maxEffectif) * chartHeight;
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', x);
                circle.setAttribute('cy', y);
                circle.setAttribute('r', 4);
                circle.setAttribute('fill', showCriticalEffectif ? '#dc2626' : '#3b82f6');
                circle.setAttribute('stroke', 'white');
                circle.setAttribute('stroke-width', 2);
                circle.style.cursor = 'pointer';
                
                circle.addEventListener('mouseenter', (e) => {
                    const tooltip = document.getElementById('tooltip');
                    tooltip.innerHTML = `<strong>Jour ${day}</strong><br>Effectif total: ${effectif} personnes`;
                    tooltip.style.left = e.pageX + 15 + 'px';
                    tooltip.style.top = e.pageY + 15 + 'px';
                    tooltip.classList.add('show');
                });
                circle.addEventListener('mouseleave', hideTooltip);
                
                svg.appendChild(circle);
            });
        }
        
        function drawLegend() {
            const legend = document.getElementById('taskLegend');
            legend.innerHTML = '';
            
            tasks.forEach(task => {
                const item = document.createElement('div');
                item.className = 'legend-item';
                
                const colorBox = document.createElement('div');
                colorBox.className = 'legend-color';
                colorBox.style.backgroundColor = colors[(task.id - 1) % colors.length];
                
                const text = document.createElement('div');
                text.className = 'legend-text';
                text.innerHTML = `T${String(task.id).padStart(2, '0')}: ${task.name}`;
                
                if (criticalPathEffectif.includes(task.id)) {
                    const badge = document.createElement('span');
                    badge.className = 'critical-badge';
                    badge.textContent = 'CRITIQUE';
                    text.appendChild(badge);
                }
                
                item.appendChild(colorBox);
                item.appendChild(text);
                legend.appendChild(item);
            });
        }
        
        function showTooltipEffectif(e, task, day) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `
                <strong>T${String(task.id).padStart(2, '0')}: ${task.name}</strong><br>
                Jour: ${day}<br>
                Effectif: ${task.effectif} personnes<br>
                Dur√©e restante: ${task.earlyStart + task.duration - day} jour(s)
                ${criticalPathEffectif.includes(task.id) ? '<br><span style="color: #fbbf24;">‚ö†Ô∏è T√ÇCHE CRITIQUE</span>' : ''}
            `;
            tooltip.style.left = e.pageX + 15 + 'px';
            tooltip.style.top = e.pageY + 15 + 'px';
            tooltip.classList.add('show');
        }
        
        function toggleView(view) {
            currentView = view;
            document.getElementById('btnStacked').classList.toggle('active', view === 'stacked');
            document.getElementById('btnCumulative').classList.toggle('active', view === 'cumulative');
            drawEffectifChart();
        }

        // Navigation function
        function scrollToSection(sectionId) {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Initialization
        const totalDuration = calculateDates();
        document.getElementById('total-duration-network').textContent = totalDuration + ' jours';
        document.getElementById('critical-tasks-network').textContent = criticalPathNetwork.length + ' t√¢ches';
        document.getElementById('total-duration-gantt').textContent = totalDuration + ' jours';
        document.getElementById('critical-tasks-gantt').textContent = criticalPathNetwork.length + ' t√¢ches';
        drawNetwork();
        drawGantt();
        drawEffectifChart();
    </script>
</body>
</html>